<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Attendance QR Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const TimetableQRGenerator = () => {
            const [qrData, setQrData] = useState(null);
            const [countdown, setCountdown] = useState(15);
            const [selectedDay, setSelectedDay] = useState('Monday');
            const [selectedSlot, setSelectedSlot] = useState(0);
            const [customDate, setCustomDate] = useState('');
            const [useCustomDate, setUseCustomDate] = useState(false);
            const [editablePayload, setEditablePayload] = useState('');
            const [isEditingPayload, setIsEditingPayload] = useState(false);
            const [useCurrentTime, setUseCurrentTime] = useState(false);
            const [useCustomQRTime, setUseCustomQRTime] = useState(false);
            const [customQRStartTime, setCustomQRStartTime] = useState('');
            const [customQREndTime, setCustomQREndTime] = useState('');

            // Timetable data structure
            const timetable = {
                Monday: [
                    { start: '08:00', end: '08:50', code: 'MECH1011' },
                    { start: '09:00', end: '09:50', code: 'MECH1011' },
                    { start: '10:00', end: '10:50', code: '24CSEN1041' },
                    { start: '11:00', end: '11:50', code: '24CSEN1041' },
                    { start: '13:00', end: '13:50', code: 'MATH1272' },
                    { start: '14:00', end: '14:50', code: 'LANG1252' },
                    { start: '15:00', end: '15:50', code: 'LANG1252' }
                ],
                Tuesday: [
                    { start: '08:00', end: '08:50', code: 'MECH1011' },
                    { start: '09:00', end: '09:50', code: 'MECH1011' },
                    { start: '10:00', end: '10:50', code: 'MATH1272' },
                    { start: '11:00', end: '11:50', code: 'CHEM1111' },
                    { start: '14:00', end: '14:50', code: '24CSEN1002' }
                ],
                Wednesday: [
                    { start: '08:00', end: '08:50', code: 'MECH1041' },
                    { start: '09:00', end: '09:50', code: 'MECH1041' },
                    { start: '10:00', end: '10:50', code: '24CSEN1041' },
                    { start: '11:00', end: '11:50', code: '24CSEN1041' },
                    { start: '14:00', end: '14:50', code: 'LANG1252' },
                    { start: '15:00', end: '15:50', code: 'LANG1252' }
                ],
                Thursday: [
                    { start: '08:00', end: '08:50', code: 'MECH1041' },
                    { start: '09:00', end: '09:50', code: 'MECH1041' },
                    { start: '10:00', end: '10:50', code: 'CHEM1111' },
                    { start: '11:00', end: '11:50', code: 'MATH1272' },
                    { start: '14:00', end: '14:50', code: '24CSEN1002' }
                ],
                Friday: [
                    { start: '08:00', end: '08:50', code: 'CHEM1111' },
                    { start: '10:00', end: '10:50', code: '24CSEN1041' },
                    { start: '11:00', end: '11:50', code: '24CSEN1041' },
                    { start: '13:00', end: '13:50', code: 'MATH1272' },
                    { start: '14:00', end: '14:50', code: 'CHEM111IP' },
                    { start: '15:00', end: '15:50', code: 'CHEM111IP' }
                ]
            };

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

            const generateRandomDate = () => {
                const start = new Date(2024, 0, 1);
                const end = new Date(2025, 11, 31);
                const randomTime = start.getTime() + Math.random() * (end.getTime() - start.getTime());
                const randomDate = new Date(randomTime);
                
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const day = String(randomDate.getDate()).padStart(2, '0');
                const month = months[randomDate.getMonth()];
                const year = randomDate.getFullYear();
                return `${day}-${month}-${year}`;
            };

            const generateRandomTimeWithSeconds = () => {
                const hours = Math.floor(Math.random() * 24);
                const minutes = Math.floor(Math.random() * 60);
                const seconds = Math.floor(Math.random() * 60);
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            };

            const addSecondsToTime = (timeStr, secondsToAdd) => {
                const [hours, minutes, seconds] = timeStr.split(':').map(Number);
                let totalSeconds = hours * 3600 + minutes * 60 + seconds + secondsToAdd;
                
                const newHours = Math.floor(totalSeconds / 3600) % 24;
                totalSeconds %= 3600;
                const newMinutes = Math.floor(totalSeconds / 60);
                const newSeconds = totalSeconds % 60;
                
                return `${String(newHours).padStart(2, '0')}:${String(newMinutes).padStart(2, '0')}:${String(newSeconds).padStart(2, '0')}`;
            };

            const generateRandomNumber = () => {
                return Math.floor(1000000 + Math.random() * 9000000);
            };

            const formatDateToString = (dateString) => {
                if (!dateString) return generateRandomDate();
                const date = new Date(dateString + 'T00:00:00');
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const day = String(date.getDate()).padStart(2, '0');
                const month = months[date.getMonth()];
                const year = date.getFullYear();
                return `${day}-${month}-${year}`;
            };

            const generateQR = () => {
                if (isEditingPayload && editablePayload) {
                    const base64Payload = btoa(editablePayload);
                    setQrData({
                        active: true,
                        payload: editablePayload,
                        base64: base64Payload,
                        isCustomPayload: true
                    });
                    return;
                }

                const currentSlot = timetable[selectedDay][selectedSlot];
                
                const randomDate = useCustomDate && customDate ? formatDateToString(customDate) : generateRandomDate();
                
                let qrStartTime, qrEndTime;
                if (useCurrentTime) {
                    const now = new Date();
                    qrStartTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                    qrEndTime = addSecondsToTime(qrStartTime, 15);
                } else if (useCustomQRTime && customQRStartTime) {
                    qrStartTime = customQRStartTime;
                    qrEndTime = customQREndTime || addSecondsToTime(qrStartTime, 15);
                } else {
                    qrStartTime = generateRandomTimeWithSeconds();
                    qrEndTime = addSecondsToTime(qrStartTime, 15);
                }
                
                const randomNum = generateRandomNumber();

                const payload = `${currentSlot.code}#${currentSlot.start}#${currentSlot.end}#${randomNum}#${randomDate}#${qrStartTime}#${qrEndTime}`;
                
                const base64Payload = btoa(payload);

                setQrData({
                    active: true,
                    payload: payload,
                    base64: base64Payload,
                    subject: currentSlot.code,
                    classTime: `${currentSlot.start} - ${currentSlot.end}`,
                    day: selectedDay,
                    randomDate: randomDate,
                    qrStartTime: qrStartTime,
                    qrEndTime: qrEndTime,
                    randomNum: randomNum,
                    isCustomPayload: false
                });
            };

            useEffect(() => {
                if (!isEditingPayload) {
                    generateQR();
                    const interval = setInterval(() => {
                        if (!isEditingPayload) {
                            generateQR();
                            setCountdown(15);
                        }
                    }, 15000);
                    return () => clearInterval(interval);
                }
            }, [selectedDay, selectedSlot, useCustomDate, customDate, isEditingPayload, useCurrentTime, useCustomQRTime, customQRStartTime, customQREndTime]);

            useEffect(() => {
                const timer = setInterval(() => {
                    setCountdown(prev => {
                        if (prev <= 1) return 15;
                        return prev - 1;
                    });
                }, 1000);

                return () => clearInterval(timer);
            }, []);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">
                                    College Attendance QR Generator
                                </h1>
                                <p className="text-gray-600 mb-4">
                                    Random Date & Time Generator (Timetable-Based)
                                </p>
                                <div className="mt-4 inline-block bg-indigo-100 px-6 py-2 rounded-full">
                                    <p className="text-indigo-700 font-semibold">
                                        Next refresh in: <span className="text-2xl">{countdown}</span>s
                                    </p>
                                </div>
                            </div>

                            <div className="mb-6 space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Select Day:</label>
                                    <select 
                                        value={selectedDay}
                                        onChange={(e) => {
                                            setSelectedDay(e.target.value);
                                            setSelectedSlot(0);
                                        }}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                    >
                                        {days.map(day => (
                                            <option key={day} value={day}>{day}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Select Time Slot:</label>
                                    <select 
                                        value={selectedSlot}
                                        onChange={(e) => setSelectedSlot(Number(e.target.value))}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                    >
                                        {timetable[selectedDay].map((slot, idx) => (
                                            <option key={idx} value={idx}>
                                                {slot.start} - {slot.end} ({slot.code})
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div className="border-t border-gray-200 pt-4">
                                    <label className="flex items-center space-x-3 mb-3 cursor-pointer">
                                        <input 
                                            type="checkbox"
                                            checked={useCustomDate}
                                            onChange={(e) => {
                                                setUseCustomDate(e.target.checked);
                                                if (e.target.checked && !customDate) {
                                                    const today = new Date().toISOString().split('T')[0];
                                                    setCustomDate(today);
                                                }
                                            }}
                                            className="w-5 h-5 cursor-pointer"
                                        />
                                        <span className="text-sm font-semibold text-gray-700">Use Custom Date</span>
                                    </label>
                                    {useCustomDate && (
                                        <input 
                                            type="date"
                                            value={customDate}
                                            onChange={(e) => setCustomDate(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        />
                                    )}
                                </div>

                                <div className="border-t border-gray-200 pt-4">
                                    <label className="flex items-center space-x-3 mb-3 cursor-pointer">
                                        <input 
                                            type="checkbox"
                                            checked={useCurrentTime}
                                            onChange={(e) => {
                                                setUseCurrentTime(e.target.checked);
                                                if (e.target.checked) {
                                                    setUseCustomQRTime(false);
                                                }
                                                generateQR();
                                            }}
                                            className="w-5 h-5 cursor-pointer"
                                        />
                                        <span className="text-sm font-semibold text-gray-700">Use Current Time</span>
                                    </label>
                                    <p className="text-xs text-gray-500 mb-3">Uses the current system time for QR generation</p>
                                </div>

                                <div className="border-t border-gray-200 pt-4">
                                    <label className="flex items-center space-x-3 mb-3 cursor-pointer">
                                        <input 
                                            type="checkbox"
                                            checked={useCustomQRTime}
                                            onChange={(e) => {
                                                setUseCustomQRTime(e.target.checked);
                                                if (e.target.checked) {
                                                    setUseCurrentTime(false);
                                                    if (!customQRStartTime) {
                                                        const now = new Date();
                                                        const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                                                        setCustomQRStartTime(timeStr);
                                                    }
                                                }
                                                generateQR();
                                            }}
                                            className="w-5 h-5 cursor-pointer"
                                        />
                                        <span className="text-sm font-semibold text-gray-700">Use Custom QR Time</span>
                                    </label>
                                    {useCustomQRTime && (
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-xs text-gray-600 mb-1">QR Start Time (HH:MM:SS)</label>
                                                <input 
                                                    type="time"
                                                    value={customQRStartTime.substring(0, 5)}
                                                    onChange={(e) => {
                                                        const start = e.target.value + ':00';
                                                        setCustomQRStartTime(start);
                                                        if (!customQREndTime) {
                                                            generateQR();
                                                        }
                                                    }}
                                                    step="1"
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs text-gray-600 mb-1">QR End Time (Optional, defaults to +15s)</label>
                                                <input 
                                                    type="time"
                                                    value={customQREndTime.substring(0, 5)}
                                                    onChange={(e) => setCustomQREndTime(e.target.value + ':00')}
                                                    step="1"
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                />
                                            </div>
                                            <button 
                                                onClick={() => generateQR()}
                                                className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition"
                                            >
                                                Update QR Code
                                            </button>
                                        </div>
                                    )}
                                </div>

                                <div className="border-t border-gray-200 pt-4">
                                    <label className="flex items-center space-x-3 mb-3 cursor-pointer">
                                        <input 
                                            type="checkbox"
                                            checked={isEditingPayload}
                                            onChange={(e) => {
                                                setIsEditingPayload(e.target.checked);
                                                if (e.target.checked && qrData) {
                                                    setEditablePayload(qrData.payload);
                                                }
                                            }}
                                            className="w-5 h-5 cursor-pointer"
                                        />
                                        <span className="text-sm font-semibold text-gray-700">Edit Custom Payload</span>
                                    </label>
                                    {isEditingPayload && (
                                        <div>
                                            <textarea 
                                                value={editablePayload}
                                                onChange={(e) => {
                                                    setEditablePayload(e.target.value);
                                                    generateQR();
                                                }}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"
                                                rows="4"
                                                placeholder="Enter custom payload..."
                                            />
                                            <p className="text-xs text-gray-500 mt-2">
                                                Edit the payload above. Changes will auto-update the QR code.
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {qrData && (
                                <div className="space-y-6">
                                    {!qrData.isCustomPayload && (
                                        <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white">
                                            <h2 className="text-2xl font-bold mb-2">{qrData.subject}</h2>
                                            <p className="text-indigo-100">Day: {qrData.day}</p>
                                            <p className="text-indigo-100">Class Time: {qrData.classTime}</p>
                                        </div>
                                    )}

                                    {qrData.isCustomPayload && (
                                        <div className="bg-gradient-to-r from-amber-500 to-orange-600 rounded-xl p-6 text-white">
                                            <h2 className="text-2xl font-bold mb-2">Custom Payload Mode</h2>
                                            <p className="text-amber-100">Displaying custom-edited QR code</p>
                                        </div>
                                    )}

                                    <div className="flex justify-center bg-gray-50 p-8 rounded-xl">
                                        <div className="bg-white p-6 rounded-lg shadow-lg">
                                            <img 
                                                src={`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(qrData.base64)}`}
                                                alt="Attendance QR Code"
                                                className="w-72 h-72"
                                            />
                                        </div>
                                    </div>

                                    {!qrData.isCustomPayload && (
                                        <>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                                    <p className="text-sm text-purple-600 font-semibold mb-1">Random Date</p>
                                                    <p className="text-purple-800 font-mono">{qrData.randomDate}</p>
                                                </div>
                                                <div className="bg-pink-50 p-4 rounded-lg border border-pink-200">
                                                    <p className="text-sm text-pink-600 font-semibold mb-1">Random 7-Digit No</p>
                                                    <p className="text-pink-800 font-mono">{qrData.randomNum}</p>
                                                </div>
                                            </div>

                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                                                    <p className="text-sm text-green-600 font-semibold mb-1">Random QR Start Time</p>
                                                    <p className="text-green-800 font-mono">{qrData.qrStartTime}</p>
                                                </div>
                                                <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                                                    <p className="text-sm text-red-600 font-semibold mb-1">QR End Time (+15s)</p>
                                                    <p className="text-red-800 font-mono">{qrData.qrEndTime}</p>
                                                </div>
                                            </div>
                                        </>
                                    )}

                                    <div className="bg-gray-50 p-6 rounded-xl space-y-4">
                                        <div>
                                            <h3 className="text-sm font-semibold text-gray-600 mb-2">Raw Payload:</h3>
                                            <div className="bg-white p-4 rounded border border-gray-200 font-mono text-sm break-all">
                                                {qrData.payload}
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-sm font-semibold text-gray-600 mb-2">Base64 Encoded:</h3>
                                            <div className="bg-white p-4 rounded border border-gray-200 font-mono text-xs break-all text-gray-700">
                                                {qrData.base64}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                        <p className="text-sm text-blue-800">
                                            <span className="font-semibold">‚ÑπÔ∏è Info:</span> {qrData.isCustomPayload ? 'Displaying custom payload. Edit above to modify the QR code data.' : 'This QR uses RANDOM dates and times but follows your timetable structure. Auto-refreshes every 15 seconds with completely new random data. You can also use a custom date or edit the payload directly!'}
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="mt-6 text-center text-gray-600 text-sm">
                            <p>‚ö° Auto-refreshing every 15 seconds | üé≤ Random data generation | üéì Timetable-coordinated</p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimetableQRGenerator />);
    </script>
</body>
</html>
